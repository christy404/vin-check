<!DOCTYPE html>
<html>
<head>
  <title>VIN Check Canada</title>
</head>
<body>

<h2>VIN Check (Canada)</h2>

<form id="vinForm">
  <input id="vin" placeholder="Enter VIN" required><br><br>
  <input id="email" placeholder="Enter Email" required><br><br>
  <button type="submit">Preview Vehicle</button>
</form>

<h3 id="preview"></h3>

<button id="payBtn" style="display:none;">Pay $4.99 & Get Full Report</button>

<script>
let VIN = "";
let EMAIL = "";

document.getElementById("vinForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  VIN = document.getElementById("vin").value;
  EMAIL = document.getElementById("email").value;

  const res = await fetch("/preview-vin", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ vin: VIN })
  });

  const data = await res.json();

  if (data.carName) {
    document.getElementById("preview").innerText = "Vehicle: " + data.carName;
    document.getElementById("payBtn").style.display = "block";
  } else {
    document.getElementById("preview").innerText = "Invalid VIN";
  }
});

document.getElementById("payBtn").addEventListener("click", async () => {
  const res = await fetch("/create-checkout-session", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ vin: VIN, email: EMAIL })
  });

  const data = await res.json();
  if (data.url) window.location = data.url;
});
</script>

</body>
</html>
